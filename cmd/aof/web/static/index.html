<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>资金流向采集器</title>
    <link rel="stylesheet" href="/static/style.css" />
  </head>
  <body>
    <main class="wrap">
      <div class="topbar">
        <div class="topbarRow">
          <nav class="nav" id="nav">
            <a class="tab" href="#/home" data-route="home">首页</a>
            <a class="tab" href="#/industry" data-route="industry">实时行业板块</a>
            <a class="tab" href="#/concept" data-route="concept">实时概念板块</a>
            <a class="tab" href="#/history-industry" data-route="history-industry">历史行业板块</a>
            <a class="tab" href="#/history-concept" data-route="history-concept">历史概念板块</a>
            <a class="tab" href="#/history" data-route="history">历史资金流量</a>
            <a class="tab" href="#/settings" data-route="settings">设置</a>
          </nav>
          <div class="topbarActions">
            <button class="chip" id="themeToggle" type="button">浅色</button>
          </div>
        </div>
      </div>


      <!-- Home: realtime dashboard -->
      <section class="card view" id="viewHome" data-view="home">
        <div class="cardHead">
          <h2>实时资金流向</h2>
          <div class="hint">数据来源：内存快照（按 persist.interval_seconds 入库）。</div>
        </div>

        <div class="grid grid2">
          <div class="panel">
            <div class="panelTitle">北向资金（当日）</div>
            <div class="kv">
              <div><span class="label">更新时间(北京时间)</span> <span class="mono" id="rtTs">-</span></div>
              <div><span class="label">沪股通 额度占比(%)</span> <span class="mono" id="nbShQuotaPct">-</span></div>
              <div><span class="label">沪股通 额度余额(亿元)</span> <span class="mono" id="nbShQuota">-</span></div>
              <div><span class="label">沪股通 成交总额(亿元)</span> <span class="mono" id="nbShTurnover">-</span></div>
              <div><span class="label">深股通 额度占比(%)</span> <span class="mono" id="nbSzQuotaPct">-</span></div>
              <div><span class="label">深股通 额度余额(亿元)</span> <span class="mono" id="nbSzQuota">-</span></div>
              <div><span class="label">深股通 成交总额(亿元)</span> <span class="mono" id="nbSzTurnover">-</span></div>
            </div>
            <div class="hint tiny" id="nbHint">提示：额度余额仅在低于 30% 时披露；成交总额通常盘后披露。</div>
          </div>

          <div class="panel">
            <div class="panelTitle">行业求和（折线图）</div>
            <canvas id="homeIndustryChart" class="chartCanvas" height="240"></canvas>
            <div class="hint tiny" id="homeIndustryHint" hidden>暂无数据</div>
          </div>
        </div>

        <div class="panel" style="margin-top:12px">
          <div class="panelTitle">自选池（主力/超大/大/中/小净流入）</div>
          <div class="tableWrap">
            <table class="tbl" id="tblWatch">
              <thead>
                <tr>
                  <th>代码</th><th>名称</th>
                  <th class="num">主力</th><th class="num">超大</th><th class="num">大单</th><th class="num">中单</th><th class="num">小单</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

      </section>

      <!-- Industry boards -->
      <section class="card view" id="viewIndustry" data-view="industry" hidden>
        <div class="cardHead">
          <h2>实时行业板块</h2>
          <div class="hint">今日板块内主力资金走势（09:00-15:00）。</div>
        </div>
        <div class="panel boardPanel">
          <div class="panelTitle">行业板块（今日折线）</div>
          <div class="hint tiny" id="boardHintInd" hidden></div>
          <div class="boardGrid" id="boardGridInd"></div>
        </div>
      </section>

      <!-- Concept boards -->
      <section class="card view" id="viewConcept" data-view="concept" hidden>
        <div class="cardHead">
          <h2>实时概念板块</h2>
          <div class="hint">今日板块内主力资金走势（09:00-15:00）。</div>
        </div>
        <div class="panel boardPanel">
          <div class="panelTitle">概念板块（今日折线）</div>
          <div class="hint tiny" id="boardHintCon" hidden></div>
          <div class="boardGrid" id="boardGridCon"></div>
        </div>
      </section>

      <!-- History -->
      <section class="card view" id="viewHistory" data-view="history" hidden>
        <div class="cardHead">
          <h2>历史资金流量</h2>
          <div class="hint">从 SQLite 读取（默认只保留近 30 天）。</div>
        </div>

        <form id="formHistory" class="grid grid2">
          <label class="field">
            <span>序列</span>
            <select id="histSource" class="sel">
              <option value="market_industry_sum">行业求和（市场汇总）</option>
              <option value="market_allstocks_sum">全A分页求和</option>
              <option value="board_industry_sum">行业版块求和</option>
              <option value="board_concept_sum">概念版块求和</option>
            </select>
          </label>
          <label class="field">
            <span>类型</span>
            <select id="histKind" class="sel">
              <option value="daily">日频数据</option>
              <option value="rt">实时数据</option>
            </select>
          </label>
          <label class="field">
            <span>回看周期</span>
            <select id="histPeriod" class="sel">
              <option value="30">近30</option>
              <option value="60">近60</option>
              <option value="90" selected>近90</option>
              <option value="180">近180</option>
              <option value="360">近360</option>
            </select>
          </label>
          <label class="field">
            <span>limit</span>
            <input type="number" min="10" max="2000" step="10" id="histLimit" value="90" />
          </label>
          <button type="submit" class="btn primary">加载</button>
        </form>

        <div class="panel" style="margin-top:12px" id="histChartPanel" hidden>
          <div class="panelTitle" id="histChartTitle">近 90 天（折线）</div>
          <canvas id="histChart" class="chartCanvas" height="240"></canvas>
        </div>

        <div class="panel" style="margin-top:12px">
          <div class="panelTitle">数据</div>
          <div class="tableWrap">
            <table class="tbl" id="tblHist">
              <thead>
                <tr id="histHead"></tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </section>

      <!-- History: Industry boards -->
      <section class="card view" id="viewHistoryIndustry" data-view="history-industry" hidden>
        <div class="cardHead">
          <h2>历史行业板块</h2>
          <div class="hint">日级别主力净流入（SQLite 本地历史）。</div>
        </div>

        <form id="formHistInd" class="grid">
          <label class="field">
            <span>回看天数</span>
            <input type="number" min="10" max="2000" step="10" id="histIndLimit" value="120" />
          </label>
          <label class="field">
            <span>板块数量</span>
            <input type="number" min="10" max="500" step="10" id="histIndBoards" value="80" />
          </label>
          <label class="field fieldToggle">
            <span>强制刷新远端</span>
            <input type="checkbox" id="histIndRefresh" />
          </label>
          <button type="submit" class="btn primary">加载</button>
        </form>

        <div class="panel boardPanel" style="margin-top:12px">
          <div class="panelTitle">行业板块（日级别折线）</div>
          <div class="boardGrid" id="boardGridHistInd"></div>
        </div>
      </section>

      <!-- History: Concept boards -->
      <section class="card view" id="viewHistoryConcept" data-view="history-concept" hidden>
        <div class="cardHead">
          <h2>历史概念板块</h2>
          <div class="hint">日级别主力净流入（SQLite 本地历史）。</div>
        </div>

        <form id="formHistCon" class="grid">
          <label class="field">
            <span>回看天数</span>
            <input type="number" min="10" max="2000" step="10" id="histConLimit" value="120" />
          </label>
          <label class="field">
            <span>板块数量</span>
            <input type="number" min="10" max="500" step="10" id="histConBoards" value="120" />
          </label>
          <label class="field fieldToggle">
            <span>强制刷新远端</span>
            <input type="checkbox" id="histConRefresh" />
          </label>
          <button type="submit" class="btn primary">加载</button>
        </form>

        <div class="panel boardPanel" style="margin-top:12px">
          <div class="panelTitle">概念板块（日级别折线）</div>
          <div class="boardGrid" id="boardGridHistCon"></div>
        </div>
      </section>

      <!-- Settings: old homepage moved here -->
      <section class="card view" id="viewSettings" data-view="settings" hidden>
        <div class="cardHead">
          <h2>设置</h2>
          <div class="hint">修改后会写回配置文件，并影响运行中的采集任务。</div>
        </div>

        <section class="subcard">
          <div class="cardHead">
            <h2 class="h3">实时采集频率</h2>
            <div class="hint">单位：秒（建议 5-60）。</div>
          </div>
          <form id="formRealtime" class="grid">
            <label class="field">
              <span>主循环间隔</span>
              <input type="number" min="1" max="600" step="1" id="rtInterval" value="20" />
            </label>
            <label class="field fieldToggle">
              <span>仅交易时段采集</span>
              <input type="checkbox" id="onlyTradeHours" />
            </label>
            <label class="field">
              <span>榜单数量(Top)</span>
              <input type="number" min="5" max="100" step="1" id="topSize" value="10" />
            </label>
            <button type="submit" class="btn primary">保存实时设置</button>
          </form>
        </section>

        <section class="subcard">
          <div class="cardHead">
            <h2 class="h3">板块采集</h2>
            <div class="hint">行业较少可全量；概念很多默认只抓 TopN。</div>
          </div>
          <form id="formBoards" class="grid">
            <div class="group">
              <div class="groupTitle">行业</div>
              <label class="field fieldToggle">
                <span>启用</span>
                <input type="checkbox" id="indEnabled" />
              </label>
              <label class="field">
                <span>间隔(秒)</span>
                <input type="number" min="5" max="3600" step="1" id="indInterval" />
              </label>
            </div>

            <div class="group">
              <div class="groupTitle">概念</div>
              <label class="field fieldToggle">
                <span>启用</span>
                <input type="checkbox" id="conEnabled" />
              </label>
              <label class="field">
                <span>间隔(秒)</span>
                <input type="number" min="5" max="3600" step="1" id="conInterval" />
              </label>
              <label class="field fieldToggle">
                <span>抓全量</span>
                <input type="checkbox" id="conAll" />
              </label>
              <label class="field">
                <span>TopN(非全量)</span>
                <input type="number" min="10" max="100" step="1" id="conTop" />
              </label>
            </div>

            <button type="submit" class="btn primary">保存板块设置</button>
          </form>
        </section>

        <section class="subcard">
          <div class="cardHead">
            <h2 class="h3">板块走势加载</h2>
            <div class="hint">影响首页板块折线图拉取节奏（仅前端）。</div>
          </div>
          <form id="formBoardTrend" class="grid">
            <label class="field">
              <span>每批数量</span>
              <input type="number" min="5" max="100" step="1" id="trendBatch" value="20" />
            </label>
            <label class="field">
              <span>并发</span>
              <input type="number" min="1" max="6" step="1" id="trendConc" value="2" />
            </label>
            <label class="field">
              <span>批次间隔(ms)</span>
              <input type="number" min="100" max="5000" step="100" id="trendGap" value="400" />
            </label>
            <label class="field">
              <span>收盘后补拉模式</span>
              <select id="trendAfterMode" class="sel">
                <option value="once">只补拉一次</option>
                <option value="interval">每 N 秒补拉</option>
              </select>
            </label>
            <label class="field">
              <span>收盘后补拉间隔(秒)</span>
              <input type="number" min="60" max="1800" step="60" id="trendAfterInterval" value="300" />
            </label>
            <button type="submit" class="btn">保存走势参数</button>
          </form>
        </section>

        <section class="subcard">
          <div class="cardHead">
            <h2 class="h3">全A分页汇总</h2>
            <div class="hint">建议 60 秒以上；并发 1-4 更稳。</div>
          </div>
          <form id="formAgg" class="grid">
            <label class="field fieldToggle">
              <span>启用</span>
              <input type="checkbox" id="aggEnabled" />
            </label>
            <label class="field">
              <span>间隔(秒)</span>
              <input type="number" min="30" max="3600" step="1" id="aggInterval" />
            </label>
            <label class="field">
              <span>并发(1-10)</span>
              <input type="number" min="1" max="10" step="1" id="aggConc" />
            </label>
            <button type="submit" class="btn primary">保存汇总设置</button>
          </form>
        </section>

        <section class="subcard">
          <div class="cardHead">
            <h2 class="h3">自选池</h2>
            <div class="hint">每行一个：如 600519.SH、000001.SZ、920152.BJ</div>
          </div>
          <form id="formWatch" class="stack">
            <textarea id="watchlist" rows="6" spellcheck="false"></textarea>
            <button type="submit" class="btn">保存自选池</button>
          </form>
        </section>
      </section>

      <footer class="foot">
        <div class="mono dim" id="buildInfo">Code by Yuhao@jiansutech.com at -</div>
      </footer>
    </main>

    <script src="/static/app.js"></script>
  </body>
</html>
